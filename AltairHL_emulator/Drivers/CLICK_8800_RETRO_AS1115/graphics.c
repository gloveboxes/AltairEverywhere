/* Copyright (c) Microsoft Corporation. All rights reserved.
   Licensed under the MIT License. */

#include "graphics.h"

// https://github.com/MikroElektronika/Matrix_R_click/blob/master/library/__matrixr_driver.c

static const uint8_t _MATRIXR_ASCII[][8] =
{
    { 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00 },   // space -- 32
    { 0x00,0x08,0x08,0x08,0x08,0x08,0x00,0x08 },   // ! -- 33
    { 0x00,0x14,0x14,0x14,0x00,0x00,0x00,0x40 },   // " -- 34
    { 0x00,0x14,0x14,0x3E,0x14,0x3E,0x14,0x54 },   // # -- 35
    { 0x00,0x08,0x1E,0x28,0x1C,0x0A,0x3C,0x08 },   // $ -- 36
    { 0x00,0x30,0x32,0x04,0x08,0x10,0x26,0x46 },   // % -- 37
    { 0x00,0x18,0x24,0x28,0x10,0x2A,0x24,0x5A },   // & -- 38
    { 0x00,0x0C,0x04,0x08,0x00,0x00,0x00,0x40 },   // ' -- 39
    { 0x00,0x08,0x10,0x20,0x20,0x20,0x10,0x08 },   // ( -- 40
    { 0x00,0x08,0x04,0x02,0x02,0x02,0x04,0x08 },   // ) -- 41
    { 0x00,0x00,0x08,0x1C,0x3E,0x1C,0x08,0x00 },   // * -- 42
    { 0x00,0x00,0x08,0x08,0x3E,0x08,0x08,0x00 },   // + -- 43
    { 0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x10 },   // , -- 44
    { 0x00,0x00,0x00,0x00,0x3E,0x00,0x00,0x00 },   // - -- 45
    { 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08 },   // . -- 46
    { 0x00,0x00,0x02,0x04,0x08,0x10,0x20,0x00 },   // / -- 47
    { 0x00,0x1C,0x22,0x22,0x22,0x22,0x22,0x1C },   // 0 -- 48
    { 0x00,0x08,0x18,0x28,0x08,0x08,0x08,0x08 },   // 1 -- 49
    { 0x00,0x1C,0x22,0x02,0x0C,0x10,0x20,0x3E },   // 2 -- 50
    { 0x00,0x1C,0x22,0x02,0x0C,0x02,0x22,0x1C },   // 3 -- 51
    { 0x00,0x04,0x0C,0x14,0x24,0x1E,0x04,0x04 },   // 4 -- 52
    { 0x00,0x3E,0x20,0x20,0x3E,0x02,0x02,0x7E },   // 5 -- 53
    { 0x00,0x0C,0x10,0x20,0x3C,0x22,0x22,0x1C },   // 6 -- 54
    { 0x00,0x3E,0x02,0x04,0x08,0x10,0x10,0x50 },   // 7 -- 55
    { 0x00,0x1C,0x22,0x22,0x1C,0x22,0x22,0x5C },   // 8 -- 56
    { 0x00,0x1C,0x22,0x22,0x1E,0x02,0x02,0x5C },   // 9 -- 57
    { 0x00,0x00,0x08,0x00,0x00,0x00,0x08,0x00 },   // : -- 58
    { 0x00,0x00,0x08,0x00,0x00,0x00,0x08,0x10 },   // ; -- 59
    { 0x00,0x04,0x08,0x10,0x20,0x10,0x08,0x04 },   // < -- 60
    { 0x00,0x00,0x00,0x3E,0x00,0x3E,0x00,0x00 },   // = -- 61
    { 0x00,0x10,0x08,0x04,0x02,0x04,0x08,0x10 },   // > -- 62
    { 0x00,0x1C,0x22,0x02,0x0C,0x08,0x00,0x08 },   // ? -- 63
    { 0x00,0x1C,0x22,0x02,0x1A,0x2A,0x2A,0x1C },   // @ -- 64
    { 0x00,0x1C,0x22,0x22,0x22,0x3E,0x22,0x22 },   // bitmap -- 65
    { 0x00,0x3C,0x22,0x22,0x3C,0x22,0x22,0x3C },   // B -- 66
    { 0x00,0x1C,0x22,0x20,0x20,0x20,0x22,0x1C },   // C -- 67
    { 0x00,0x38,0x24,0x22,0x22,0x22,0x24,0x38 },   // D -- 68
    { 0x00,0x3E,0x20,0x20,0x3C,0x20,0x20,0x3E },   // E -- 69
    { 0x00,0x3E,0x20,0x20,0x3C,0x20,0x20,0x20 },   // F -- 70
    { 0x00,0x1C,0x22,0x20,0x2E,0x22,0x22,0x1E },   // G -- 71
    { 0x00,0x22,0x22,0x22,0x3E,0x22,0x22,0x22 },   // H -- 72
    { 0x00,0x1C,0x08,0x08,0x08,0x08,0x08,0x1C },   // I -- 73
    { 0x00,0x0E,0x04,0x04,0x04,0x04,0x24,0x18 },   // J -- 74
    { 0x00,0x22,0x24,0x28,0x30,0x28,0x24,0x22 },   // K -- 75
    { 0x00,0x20,0x20,0x20,0x20,0x20,0x20,0x3E },   // L -- 76
    { 0x00,0x22,0x36,0x2A,0x2A,0x22,0x22,0x22 },   // M -- 77
    { 0x00,0x22,0x22,0x32,0x2A,0x26,0x22,0x22 },   // N -- 78
    { 0x00,0x1C,0x22,0x22,0x22,0x22,0x22,0x1C },   // O -- 79
    { 0x00,0x3C,0x22,0x22,0x3C,0x20,0x20,0x20 },   // P -- 80
    { 0x00,0x1C,0x22,0x22,0x22,0x2A,0x24,0x1A },   // Q -- 81
    { 0x00,0x3C,0x22,0x22,0x3C,0x28,0x24,0x22 },   // R -- 82
    { 0x00,0x1E,0x20,0x20,0x1C,0x02,0x02,0x3C },   // S -- 83
    { 0x00,0x3E,0x08,0x08,0x08,0x08,0x08,0x08 },   // T -- 84
    { 0x00,0x22,0x22,0x22,0x22,0x22,0x22,0x1C },   // U -- 85
    { 0x00,0x22,0x22,0x22,0x22,0x22,0x14,0x08 },   // V -- 86
    { 0x00,0x22,0x22,0x22,0x2A,0x2A,0x2A,0x14 },   // W -- 87
    { 0x00,0x22,0x22,0x14,0x08,0x14,0x22,0x22 },   // X -- 88
    { 0x00,0x22,0x22,0x22,0x1C,0x08,0x08,0x08 },   // Y -- 89
    { 0x00,0x3E,0x02,0x04,0x08,0x10,0x20,0x3E },   // Z -- 90
    { 0x00,0x30,0x20,0x20,0x20,0x20,0x20,0x30 },   // [ -- 91
    { 0x00,0x00,0x20,0x10,0x08,0x04,0x02,0x00 },   // \ -- 92
    { 0x00,0x0E,0x02,0x02,0x02,0x02,0x02,0x0E },   // ] -- 93
    { 0x00,0x08,0x14,0x00,0x00,0x00,0x00,0x00 },   // ^ -- 94
    { 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3E },   // _ -- 95
    { 0x00,0x08,0x04,0x00,0x00,0x00,0x00,0x00 },   // ` -- 96
    { 0x00,0x00,0x00,0x1C,0x02,0x1E,0x22,0x1E },   // a -- 97
    { 0x00,0x20,0x20,0x20,0x2C,0x32,0x22,0x3C },   // b -- 98
    { 0x00,0x00,0x00,0x3C,0x20,0x20,0x22,0x3C },   // c -- 99
    { 0x00,0x02,0x02,0x02,0x1A,0x26,0x22,0x1E },   // d -- 100
    { 0x00,0x00,0x00,0x1C,0x22,0x3E,0x20,0x1C },   // e -- 101
    { 0x00,0x0C,0x12,0x10,0x38,0x10,0x10,0x10 },   // f -- 102
    { 0x00,0x00,0x1E,0x22,0x22,0x1E,0x02,0x1C },   // g -- 103
    { 0x00,0x20,0x20,0x20,0x2C,0x32,0x22,0x22 },   // h -- 104
    { 0x00,0x00,0x08,0x00,0x08,0x08,0x08,0x08 },   // i -- 105
    { 0x00,0x04,0x00,0x0C,0x04,0x04,0x24,0x18 },   // j -- 106
    { 0x00,0x20,0x20,0x24,0x28,0x30,0x28,0x24 },   // k -- 107
    { 0x00,0x18,0x08,0x08,0x08,0x08,0x08,0x1C },   // l -- 108
    { 0x00,0x00,0x00,0x34,0x2A,0x2A,0x22,0x22 },   // m -- 109
    { 0x00,0x00,0x00,0x2C,0x32,0x22,0x22,0x22 },   // n -- 110
    { 0x00,0x00,0x00,0x1C,0x22,0x22,0x22,0x1C },   // o -- 111
    { 0x00,0x00,0x00,0x3C,0x22,0x3C,0x20,0x20 },   // p -- 112
    { 0x00,0x00,0x00,0x1A,0x26,0x1E,0x02,0x02 },   // q -- 113
    { 0x00,0x00,0x00,0x2C,0x32,0x20,0x20,0x20 },   // r -- 114
    { 0x00,0x00,0x00,0x1C,0x20,0x1C,0x02,0x3C },   // s -- 115
    { 0x00,0x10,0x10,0x38,0x10,0x10,0x12,0x0C },   // t -- 116
    { 0x00,0x00,0x00,0x22,0x22,0x22,0x26,0x1A },   // u -- 117
    { 0x00,0x00,0x00,0x22,0x22,0x22,0x14,0x28 },   // v -- 118
    { 0x00,0x00,0x00,0x22,0x22,0x2A,0x2A,0x1C },   // w -- 119
    { 0x00,0x00,0x00,0x22,0x14,0x08,0x14,0x22 },   // x -- 120
    { 0x00,0x00,0x00,0x22,0x22,0x1E,0x02,0x1C },   // y -- 121
    { 0x00,0x00,0x00,0x3E,0x04,0x08,0x10,0x3E },   // z -- 121
};


/// <summary>
/// http://www.icodeguru.com/Embedded/Hacker%27s-Delight/048.htm
/// </summary>
/// <param name="bitmap"></param>
/// <param name="m"></param>
/// <param name="n"></param>
/// <param name="B"></param>
void gfx_rotate_counterclockwise(unsigned char A[8], uint32_t m, uint32_t n, unsigned char B[8])
{
	uint32_t x, y, t;

	// Load the array and pack it into x and y. 

	x = (A[0] << 24) | (A[m] << 16) | (A[2 * m] << 8) | A[3 * m];
	y = (A[4 * m] << 24) | (A[5 * m] << 16) | (A[6 * m] << 8) | A[7 * m];

	t = (x ^ (x >> 7)) & 0x00AA00AA;  x = x ^ t ^ (t << 7);
	t = (y ^ (y >> 7)) & 0x00AA00AA;  y = y ^ t ^ (t << 7);

	t = (x ^ (x >> 14)) & 0x0000CCCC;  x = x ^ t ^ (t << 14);
	t = (y ^ (y >> 14)) & 0x0000CCCC;  y = y ^ t ^ (t << 14);

	t = (x & 0xF0F0F0F0) | ((y >> 4) & 0x0F0F0F0F);
	y = ((x << 4) & 0xF0F0F0F0) | (y & 0x0F0F0F0F);
	x = t;

	B[0] = x >> 24;    B[n] = x >> 16;    B[2 * n] = x >> 8;  B[3 * n] = x;
	B[4 * n] = y >> 24;  B[5 * n] = y >> 16;  B[6 * n] = y >> 8;  B[7 * n] = y;
}

uint8_t gfx_reverse_byte(uint8_t data)
{
	data = (data & 0xF0) >> 4 | (data & 0x0F) << 4;
	data = (data & 0xCC) >> 2 | (data & 0x33) << 2;
	data = (data & 0xAA) >> 1 | (data & 0x55) << 1;
	return data;
}

void gfx_reverse_panel(unsigned char A[8])
{
    for (uint8_t i = 0; i < 8; i++) {
           A[i] = gfx_reverse_byte(A[i]);
    }
}

void gfx_load_character(uint8_t character, uint8_t bitmap[8])
{
    int i;
    int j;

    for (i = 7; i >= 0; i--) {
        switch (i) {
        case 0: j = 7;
            break;
        case 1: j = 6;
            break;
        case 2: j = 5;
            break;
        case 3: j = 4;
            break;
        case 4: j = 3;
            break;
        case 5: j = 2;
            break;
        case 6: j = 1;
            break;
        case 7: j = 0;
            break;
        }
        bitmap[j] = _MATRIXR_ASCII[character - 32][i];
    }
}

